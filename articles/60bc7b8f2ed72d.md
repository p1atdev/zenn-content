---
title: "V言語で Hello, World"
emoji: "✌️"
type: "tech"
topics: ["vlang"]
published: false
---

# V 言語とは
V ってなんかかっこいいですよね。

https://vlang.io/
https://github.com/vlang/v

V 言語は最近出てきたプログラミング言語です。
公式サイトには

> The V Programming Language
> Simple, fast, safe, compiled. For developing maintainable software.

と書いてあります。
シンプルで速くて安全らしいです。

# 私の環境

OS: macOS 12.3 21E230 x86_64
デバイス: MacBook Pro 2019 13インチ
CPU: Intel i7-8569U (8) @ 2.80GHz
メモリ: 16GB

# インストール
ドキュメント
https://github.com/vlang/v/blob/master/doc/docs.md

現在(2022/04/05)時点では、ソースからビルドする方法しかないようです。
大人しくビルドします。
`git` と C コンパイラ(`tcc`、`gcc`、`clang` のどれか)、`make` が必要です。

Linux、macOS 系の場合
```bash:Terminal
git clone https://github.com/vlang/v
cd v
make
```

Windows の場合
```bash:Terminal
git clone https://github.com/vlang/v
cd v
make.bat -tcc
```

グローバルで `v` を使いたい場合は
```bash:Terminal
sudo ./v symlink
```
でどこでも `v` が使えるようになります。

## `v`

`v help` でコマンドの説明が見れます。

```bash:Terminal
$ v help                                              
V is a tool for managing V source code.

Usage:
   v [options] [command] [arguments]

Examples:
   v hello.v                 Compile the file `hello.v` and output it as `hello` or `hello.exe`.
   v run hello.v             Same as above but also run the produced executable immediately after compilation.
   v -cg run hello.v         Same as above, but make debugging easier (in case your program crashes).
   v -o h.c hello.v          Translate `hello.v` to `h.c`. Do not compile further.
   v -o - hello.v            Translate `hello.v` and output the C source code to stdout. Do not compile further.

   v watch hello.v           Re-does the same compilation, when a source code change is detected.
                             The program is only compiled, not run.
   v watch run hello.v       Re-runs the same `hello.v` file, when a source code change is detected.

V supports the following commands:
* New project scaffolding:
   new               Setup the file structure for a V project (in a sub folder).
   init              Setup the file structure for an already existing V project.

* Ordinary development:
   run               Compile and run a V program.
   test              Run all test files in the provided directory.
   fmt               Format the V code provided.
   vet               Report suspicious code constructs.
   doc               Generate the documentation for a V module.
   vlib-docs         Generate and open the documentation of all the vlib modules.
   repl              Run the REPL.
   watch             Re-compile/re-run a source file, each time it is changed.

* Installation/self updating:
   symlink           Create a symbolic link for V.
   up                Run the V self-updater.
   self [-prod]      Run the V self-compiler, use -prod to optimize compilation.
   version           Print the version text and exits.

* Module/package management:
   install           Install a module from VPM.
   remove            Remove a module that was installed from VPM.
   search            Search for a module from VPM.
   update            Update an installed module from VPM.
   upgrade           Upgrade all the outdated modules.
   list              List all installed modules.
   outdated          List installed modules that need updates.
   show              Display information about a module on vpm

* Others:
   doctor            Display some useful info about your system to help reporting bugs.
   translate         Translate C code to V (coming soon in 0.3).
   tracev            Produce a tracing version of the v compiler.
                     Use `tracev yourfile.v` when the compiler panics.
                     NB: `tracev` is much slower and more verbose than ordinary `v`

Use "v help <command>" for more information about a command, example: `v help build`, `v help build-c`, `v help build-native`
Use "v help other" to see less frequently used commands.
Use "v help topics" to see a list of all known help topics.

Note: Help is required to write more help topics.
Only build, new, init, doc, fmt, vet, run, test, watch, search, install, remove, update, bin2v, check-md are properly documented currently.
```

```bash:Terminal
v
```
で Python のように対話モードに入ることができます。

```bash:Terminal
$ v                                                   
 ____    ____ 
 \   \  /   /  |  Welcome to the V REPL (for help with V itself, type  exit , then run  v help ).
  \   \/   /   |  Note: the REPL is highly experimental. For best V experience, use a text editor, 
   \      /    |  save your code in a  main.v  file and execute:  v run main.v 
    \    /     |  V 0.2.4 0bd8fbc . Use  list  to see the accumulated program so far.
     \__/      |  Use Ctrl-C or  exit  to exit, or  help  to see other available commands.
```

四則演算はこんな感じになります。

```bash:Terminal
>>> 1 + 1  
2
>>> 3 * 4
12
>>> 0.004 - 0.001
0.003
>>> 1 / 3
0
>>> 1.0 / 3.0
0.3333333
```

計算は普通にできるのですが、体感めちゃくちゃ遅いです。
足し算に2秒くらいかかってる気がします。

# Hello, World する
## 拡張機能
私はVS Codeを使うので、[拡張機能](https://marketplace.visualstudio.com/items?itemName=vlanguage.vscode-vlang)をインストールします。
シンタックスハイライトやスニペットが付いてきます。

https://marketplace.visualstudio.com/items?itemName=vlanguage.vscode-vlang

## プロジェクト作成

先ほどインストールした `v` コマンドを使うと簡単にプロジェクトが作成できます。

```bash:Terminal
$ v new
Input your project name: hello_world
Input your project description: 
Input your project version: (0.0.0) 
Input your project license: (MIT)    
Initialising ...
Complete!
```

`npm init` と似てますね。
実行すると、新たに `hello_world` という名前のディレクトリが作成されます。
これを VS Code で開きます。

![](https://storage.googleapis.com/zenn-user-upload/0325f9a3cbd5-20220405.png =300x)

おそらくこんな感じの構成になっていると思います。
(`.gitignore` がネストしているのは他の拡張機能のせいです。)

## 実行
すでに `Hello, World` を出力するプログラムはできているので、後は実行するだけです。

```bash:Terminal
$ v run ./hello_world.v
Hello World!
```

できました。
と言っても何もコードを書いてないので何か編集してみましょう。

# ちょっといじってみる

元のコードはこんな感じになっていると思います。

```v:./hello_world.v
module main

fn main() {
	println('Hello World!')
}
```

ほとんど Go ですね。
他の文法も Go とほぼ同じです。
Go と異なり、未使用の変数や関数があっても怒られることはありません。

以下の解説はほぼ[公式ドキュメント](https://github.com/vlang/v/blob/master/doc/docs.md)と同じなので、よくわからなかったらそちらを参照してください。

## コードのフォーマット

コードをフォーマットするには、
```bash:Terminal
v fmt ./main.v -w 
```
のようにします。
`-w` オプションをつけることでフォーマット結果で上書き(write)してくれます。
また、現在のディレクトリ内のファイル全てをフォーマットしたい場合は、

```bash:Terminal
v fmt . -w 
```
で全部フォーマットしてくれます。

## 変数
変数の定義をしてみます。

```v:./hello_world.v
module main

fn main() {
	name := 'hoge'
	println('Hello, $name!') // このようにすると変数が展開されます

	// a を定義
	// 型は推論されます
	a := 5

	println('a is $a') // a is 5
	println('a is ${typeof(a).name}') // a is int

	b := a * 2

	println('b is $b') // b is 10

	// 基本的に `:=` で宣言された変数はイミュータブル、不可変です(じゃあ変数じゃなくて定数じゃないかと思うけど定数はまた別)
	// a = 8 // これはコンパイルエラーになります
}
```

V では `var` や `let` は存在しません。変数は `:=` 演算子によって宣言します。
後述しますが、Go と異なり、`:=` で宣言するだけでは後から変更を加えることができません。 

実行
```bash:Terminal
$ v run ./hello_world.v
Hello, hoge!
a is 5
a is int
b is 10
```

変数展開が独特ですね。シンプルで好きです。
変数以外を展開したい場合は `${}` 内に書くと展開できます。

## 可変な変数

ミュータブル、可変な変数を宣言するには先頭に `mut` をつけます。
Go のように、同時に二つ以上の変数に代入することもできます。

```v:./hello_world.v
module main

fn main() {
	mut a := 1

	println('a: $a') // a: 1

	a = a * 5

	println('a: $a') // a: 5

	mut b := 8

	println('b: $b') // b: 8

	a, b = b, a

	println('a, b: $a, $b') // a, b: 8, 5
}
```


## 関数

V の関数は Rust と Go を合わせた感じです。

```v:./hello_world.v
module main

fn main() {
	a, b := 5, 8
	println('${add(a, b)}') // 13
}

fn add(x int, y int) int {
	return x + y
}
```
実行
```bash:Terminal
$ v run ./hello_world.v
13
```

Rust のように `fn` で宣言しますが、Go のように引数、返り値の型の指定にセミコロンや矢印を使いません。Rust 要素は `fn` しかないです。
C++ などとは違い、後ろで宣言されている関数でも呼び出すことができます。


## 定数

定数は絶対的に不可変で、宣言するには必ず関数の外側でしなければなりません。

```v:./hello_world.v
module main

const (
	pi = 3.14
)

fn main() {
	r := 2.0

	s := circle_area(r)

	println('s: $s')
}

fn circle_area(r f64) f64 {
	return pi * r * r
}
```
実行
```bash:Terminal
v run ./hello_world.v
s: 12.56
```

## ループ

