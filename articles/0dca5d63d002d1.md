---
title: "V è¨€èªã§ç°¡æ˜“HTTPã‚µãƒ¼ãƒãƒ¼"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vlang"]
published: true
---

# V è¨€èª

V è¨€èªã®ç’°å¢ƒæ§‹ç¯‰ãªã©ã¯ä»¥ä¸‹ã‚’å‚ç…§
https://zenn.dev/platina/articles/5ce280b557c4ca

# å®Ÿè£…

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

ã¾ãšã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€‚

```bash:Terminal
v new http_server
```

## ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã

vweb ã¨ã„ã†å…¬å¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã¾ã™ã€‚
https://github.com/vlang/v/tree/master/vlib/vweb

ãŠãã‚‰ãã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚Œã°å¤§ä½“ã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚

```v:http_server.v
module main

import vweb

fn main() {
	vweb.run(&App{}, 8080)
}

struct App {
	vweb.Context
}

// http://localhost:8080
fn (mut app App) index() vweb.Result {
	return app.html('<h1>Index</h1>')
}

// http://localhost:8080/hello
['/hello']
fn (mut app App) world() vweb.Result {
	return app.text('Hello, World!')
}

// http://localhost:8080/hello/world
['/hello/:user']
fn (mut app App) hello_user(user string) vweb.Result {
	return app.text('Hello, $user!')
}

// POST http://localhost:8080/post_request
[post]
fn (mut app App) post_request() vweb.Result {
	return app.text('POST request!')
}

// POST http://localhost:8080/post/name
['/post/:name'; post]
fn (mut app App) post_with_name(name string) vweb.Result {
	return app.text('POST, $name!')
}

```

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€

```bash:Terminal
$ v run .
[Vweb] Running app on http://localhost:8080/
```

ã“ã®ã‚ˆã†ã«ãƒãƒ¼ãƒˆ 8080 ã§ã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚

## ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹

http://localhost:8080 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€

![](/images/2022-04-05-15-56-14.png =480x)

ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®

```v
// http://localhost:8080
fn (mut app App) index() vweb.Result {
	return app.html('<h1>Index</h1>')
}
```

ã®éƒ¨åˆ†ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚
åŸºæœ¬çš„ã«ã€é–¢æ•°åã¨åŒã˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚
`index` ã¨ã„ã†åå‰ã®é–¢æ•°ãªã®ã§ã€`/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`'<h1>Index</h1>'` ãŒ `html` ã¨ã—ã¦è¿”ã£ã¦ãã¾ã™ã€‚

http://localhost:8080/hello ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€

![](/images/2022-04-05-15-48-03.png =480x)

ã“ã®ã‚ˆã†ã«ã€ `Hello, World!` ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```v
// http://localhost:8080/hello
['/hello']
fn (mut app App) world() vweb.Result {
	return app.text('Hello, World!')
}
```

é–¢æ•°åã¯ `world` ã§ã™ãŒã€ `['/hello']` ã¨ã„ã†æŒ‡å®šãŒã‚ã‚‹ã®ã§ã€ `/hello` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚

http://localhost:8080/hello/hoge ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€

![](/images/2022-04-05-15-48-31.png =480x)

ã®ã‚ˆã†ã«ã€ `Hello, hoge!` ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```v
// http://localhost:8080/hello/world
['/hello/:user']
fn (mut app App) hello_user(user string) vweb.Result {
	return app.text('Hello, $user!')
}
```

`['/hello/:user']` ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã¨ã€é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦ `user` ã‚’å—ã‘å–ã‚‹ã“ã¨ã§ãã®ã¾ã¾ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚

http://localhost:8080/post ã«ã¯ã€ `POST` ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã“ã¨ã§

```bash
$ curl -X POST http://localhost:8080/post
POST request!
```

ã¨è¿”ã£ã¦ãã¾ã™ã€‚

```v
// POST http://localhost:8080/post_request
[post]
fn (mut app App) post_request() vweb.Result {
	return app.text('POST request!')
}
```

ã“ã“ã§æŒ‡å®šã•ã‚Œã‚‹ `[post]` ã¯ã€`net.http` ã® `Method` enum ã® `post` ã®ã‚ˆã†ã§ã™ã€‚
ã©ã“ã‹ã‚‰ã‚‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ãªãã¦ãªã‚“ã‹æ°—æŒã¡æ‚ªã„ã§ã™ãŒ V è¨€èªã¯ã“ã†ã„ã†æ„Ÿã˜ã ã¨å‰²ã‚Šåˆ‡ã‚‹ã¨ã„ã„ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

Method ã®è©³ç´°
https://github.com/vlang/v/blob/master/vlib/net/http/method.v

POST ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹å ´åˆã¯ã€

```v
// POST http://localhost:8080/post/name
['/post/:name'; post]
fn (mut app App) post_with_name(name string) vweb.Result {
	return app.text('POST, $name!')
}
```

ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€
http://localhost:8080/post/foo ã« `POST` ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã¨

```bash
$ curl -X POST http://localhost:8080/post/foo
POST, foo!
```

ã¨è¿”ã£ã¦ãã¾ã™ã€‚

# çµ‚ã‚ã‚Š

V è¨€èªã«ã‚ˆã‚‹ç°¡æ˜“çš„ãª HTTP ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
vweb ã§ã¯ä»–ã«ã‚‚é™çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã®é…ä¿¡ã‚‚ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚è©³ç´°ã¯ vweb ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
https://github.com/vlang/v/blob/master/vlib/vweb/vweb.v
